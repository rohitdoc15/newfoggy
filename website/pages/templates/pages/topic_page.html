{% include 'header.html' %}

{% load static %}

<head>
    <title>Trending News on {{ title }} | Trends, Top Channels, Latest Videos| Foggymedia</title>
    <meta name="description" content="Explore the latest trending news on {{ title }} and gain insights into their popularity, top channels covering the topics, and access to the latest videos. Stay informed with our dynamic data.">
  
  </head>

    <title>{{ title }}</title>

    <body class="lg:max-w-[1200px]">
        <div class="custom-font">
            <div class="flex py-5 align-middle items-center w-full justify-center place-items-center">
                <h1 id="title" class="card-title align-middle  text-white text-xl font-bold px-5">#{{ title }}</h1>
            </div>
        </div>  

        <div class="flex flex-col lg:grid lg:grid-cols-2 lg:py-5  gap-2 ">
            <div class=" lg:mx-auto bg-gray-800 rounded-xl border border-[#787A91] border-opacity-50 shadow-md overflow-hidden md:max-w-2xl  text-white lg:w-full mx-4 ">
                <div class="flex flex-col md:flex-row text-2xs md:text-sm w-full md:h-full">
                    <div class="align-baseline p-2 lg:p-8 border-b md:border-b-0 md:border-r border-gray-500 text-center md:text-left display-font ">
                        <div class="text-base text-sm font-medium text-gray-400  ">
                            First appeared on
                        </div>
                        <div class="md:text-2xl font-bold text-[#ff4560]">
                            {{ first_appeared_date|date:"F d, Y" }}
                        </div>
                    </div>
                    
                    <div class="p-2 w-full mx-auto flex flex-col place-items-center ">
                        <img src="{{ last_video_thumbnail_url }}" alt="Last Video Thumbnail" class="object-cover h-36 w-96 rounded-lg lg:w-full lg:h-full">

                    </div>
                </div>
            </div>
    
            <div id="topicDetailTopChannels" class="rounded-xl w-full h-auto   lg:px-6 text-white lg:border lg:border-[#787A91] lg:border-opacity-50 ">
                <div class="p-4 md:p-2 mt-auto">
                    <h2 class="text-[#FF4560]  flex flex-row justify-center font-bold mb-4 px-4 py-2 text-sm">Top Channels Covering "{{ title }}" <button id="trendingTopics" class="text-white shadow-lg rounded-full focus:outline-none">
                        <i class="fas fa-info-circle fa-xs text-[#ff4560] p-1"></i>
                    </button></h2>
                    <div class="flex justify-end">
                        <button class="exclude-from-download" onclick="downloadElementAsImage('topicDetailTopChannels', 'topicDetailTopChannelsChart.png')">
                            <i class="fa-solid fa-circle-arrow-down fa-sm shadow-lg p-1 text-gray-500"></i>
                        </button>
                    </div>
                    <p class="text-sm md:text-base leading-6 text-gray-400 mb-2 ">Total videos for this topic: {{ topic_count }}</p>
                    <ul class="space-y-2 md:space-y-4">
                        {% for channel in top_channels %}
                            {% if channel.video_count > 0 %}
                                {% with rank=forloop.counter %}
                                    <li class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <span class="inline-block h-6 w-6 md:h-8 md:w-8 rounded-full overflow-hidden bg-gray-700 text-white text-sm font-medium text-center lg:py-2">{{ rank }}</span>
                                        </div>
                                        <div class="flex items-center ml-2 md:ml-4">
                                            <img class="h-6 w-6 md:h-10 md:w-10 rounded-full" src="{{ channel.logo.url }}" alt="{{ channel.name }} logo">
                                            <a href="{% url 'channel_name' slug=channel.slug %}" class="ml-2 text-xs md:text-sm leading-6 font-medium text-white underline hover:text-blue-500">{{ channel.name }}</a>
                                        </div>
                                        <div class="ml-auto text-sm md:text-base leading-6 text-gray-400">{{ channel.video_count }}</div>
                                    </li>
                                {% endwith %}
                            {% endif %}
                        {% endfor %}
                        
                    </ul>
                    
                </div>
            </div>
        </div>

        
        {% if related_topics %}
        <div class=" text-white rounded-lg shadow-lg p-4 bg-gray-800 lg:flex lg:flex-row lg:gap-2 lg:py-2 lg:place-items-center">
          <h2 class="text-sm font-bold mb-2 lg:pt-2">Related Topics</h2>
          <div class="text- flex gap-3 overflow-x-auto">
            {% for topic in related_topics %}
            <div class="flex items-center justify-between py-2 gap-3 bg-gray-900 rounded-lg px-2 shadow-lg lg:py-1 hover:bg-gray-500 ">
              <a href="{% url 'topic_details' topic=topic.topic %}" class="flex-nowrap">
                <button class="w-auto text-left text-white flex-1" style="font-size:10px; white-space:nowrap;">
                  {{ topic.topic }}
                </button>
              </a>
              <span class="bg-[#ff4560] text-white rounded-lg px-3 py-1 text-xs flex-shrink-0">{{ topic.video_count }}</span>
            </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}


      <div class="mt-4">
      <div class="flex flex-row items-center justify-center gap-1">
      <h1 class="text-[#ff4560] flex justify-center text-sm font-bold  lg:pt-2 ">Live News Bulletins </h1>
      <i class="fa-regular fa-circle-dot fa-beat-fade fa-xs" style="color: #f50000;"></i>
    </div>
      <div id="bulletins" class="flex flex-col items-center ml-4"></div>
      <button id="loadMoreBtn" class="ml-4 -mt-1 bg-transparent border border-gray-300 hover:bg-[#ff4560] hover:opacity-80 text-gray-300 text-[10px] font-bold py-1 px-2 rounded">
        Load More
        <i class="fa-solid fa-angles-down fa-fade" style="color: #ffffff;"></i>
      </button>
    </div>
  
      <script>
        const topic = "{{ title }}";
        const encodedTopic = encodeURIComponent(topic);
        let offset = 0;
        const limit = 4;
  
        function fetchBulletins() {
            const url = `/bulletins/?topic=${encodedTopic}&limit=${limit}&offset=${offset}`;
          
            fetch(url)
              .then((response) => response.json())
              .then((data) => {
                const bulletinsData = data.bulletins;
                const totalBulletins = data.total_bulletins;
          
                let bulletinsDiv = document.getElementById("bulletins");
          
                for (let bulletin of bulletinsData) {
                  let bulletinCard = document.createElement("ul");
                  bulletinCard.classList.add("bulletin-card", "p-4", "border-l","border-gray-300");
          
                  let date = new Date(bulletin.first_video_timestamp);
                  let formattedDate = `${date.getHours()}:${("0" + date.getMinutes()).slice(-2)} ${date.getDate()} ${date.toLocaleString("default", { month: "long" })} ${date.getFullYear()}`;
          
                  let liElement = document.createElement("li");
                  liElement.classList.add("ml-4", "relative");
          
                  let absoluteElement = document.createElement("div");
                  absoluteElement.classList.add( "absolute","w-3", "h-3", "bg-gray-300", "rounded-full",  "-ml-[38px]", "lg:border", "border-white", "dark:border-gray-900");
                  liElement.appendChild(absoluteElement);
          
                  let timestampDiv = document.createElement("div");
                  timestampDiv.classList.add("timestamp", "text-[11px]", "font-bold", "text-gray-400");
                  timestampDiv.textContent = formattedDate;
                  liElement.appendChild(timestampDiv);
          
                  let headlineDiv = document.createElement("div");
                  headlineDiv.classList.add("headline", "text-gray-200", "text-[11px]", "lg:text-sm");
                  headlineDiv.textContent = bulletin.headline;
                  liElement.appendChild(headlineDiv);
          
                  bulletinCard.appendChild(liElement);
                  bulletinsDiv.appendChild(bulletinCard);
                }
          
                const loadMoreBtn = document.getElementById("loadMoreBtn");
                if (offset + limit < totalBulletins) {
                  loadMoreBtn.style.display = "block";
                  loadMoreBtn.addEventListener("click", loadMoreBulletins);
                } else {
                  loadMoreBtn.style.display = "none";
                }
              });
          }
          
  
        function loadMoreBulletins() {
          offset += limit;
          fetchBulletins();
        }
  
        window.onload = fetchBulletins;
      </script>


        
            <div class=" rounded-xl shadow-md m-4">
            <h2 class="text-[#FF4560]  flex flex-row justify-center font-bold mb-4 px-4 py-2  ">"{{ title }}" Popularity Over Week <button id="popularityOverWeek" class="text-white shadow-lg rounded-full focus:outline-none">
                <i class="fas fa-info-circle fa-xs text-[#ff4560] p-1"></i>
            </button></h2>
            <div id="chart" class="w-full  "></div>
            </div>

            <script>
                var options = {
                    chart: {
                        type: 'area',
                        foreColor: '#ffffff',
                        zoom: {
                            enabled: false
                        },
                        toolbar: {
                            show: false
                        },
                        theme: {
                            mode: 'dark',
                        },
                        height: 350,
                    },
                   
                    dataLabels: {
                        enabled: false
                    },
                    stroke: {
                        curve: 'smooth',
                        width: 2,
                    },
                    series: [{
                        name: 'Topic Popularity',
                        data: {{ daily_counts_json | safe }} // Django will replace the placeholder with actual data
                    }],
                    xaxis: {
                        categories: {{ day_labels | safe }}, // Django will replace with actual data
                        labels: {
                            style: {
                                colors: '#f9fafb'
                            }
                        }
                    },
                    yaxis: {
                        
                        labels: {
                            style: {
                                colors: '#f9fafb'
                            }
                        }
                    },
                    grid: {
                        borderColor: '#4A5568'
                    },
                    fill: {
                        type: 'gradient',
                        gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.7,
                            opacityTo: 0.5,
                            stops: [0, 90, 100]
                        }
                    },
                }
    
                var chart = new ApexCharts(document.querySelector("#chart"), options);
    
                chart.render();
            </script>



            <div class="rounded-xl overflow-hidden mx-4 lg:mx-0 my-2 border border-[#787A91] border-opacity-50 shadow-lg text-[#EEEEEE]">
                <div class="p-4 md:p-8">
                  <h2 class="text-[#FF4560] flex flex-row justify-center font-bold mb-4 px-4 py-2">Latest Videos</h2>
                  <ul class="space-y-2 md:space-y-4">
                    {% for video in latest_videos %}
                      <li class="flex items-center border-gray-800 border-b">
                        <div class="flex-shrink-0">
                          <div class="h-18 w-24">
                            <img class="object-contain rounded-lg" src="{{ video.thumbnail_url }}" alt="Video Thumbnail">
                          </div>
                        </div>
                        <div class="ml-4">
                          <h3 class="text-xs md:text-sm leading-5 font-medium text-white hover:text-[#FF2949] cursor-pointer">
                            <a href="{{ video.video_url }}" target="_blank" rel="noopener noreferrer">{{ video.title }}</a>
                          </h3>
                          <p class="text-xs text-gray-400">{{ video.channel.name }}</p>
                          <p class="text-xs text-gray-400">{{ video.published_date }}</p>
                        </div>
                      </li>
                    {% empty %}
                      <p class="text-gray-400">No videos available.</p>
                    {% endfor %}
                  </ul>
                  <!-- Pagination Navigation -->
                </div>
              </div>
              


            <div class=" fact-check-section bg-gray-800 rounded-xl shadow-md overflow-hidden border border-[#787A91] border-opacity-50  my-4 text-white lg:w-full ">
                <h2 class="text-[#FF4560]  flex flex-row justify-center font-bold mb-4 px-4 py-2 "> Recent Fact Check <button id="topicFactCheck" class="text-white shadow-lg rounded-full focus:outline-none">
                    <i class="fas fa-info-circle fa-xs text-[#ff4560] p-1"></i>
                </button></h2>
                <ul id="fact-check-list" class="fact-check-list text-xs p-4">
                    <!-- Fact checks will be inserted here by JavaScript -->       
                </ul>
                
                    <!-- Fact checks will be inserted here by JavaScript -->
                    
                </ul>
                <button class=" flex justify-center ">
                    <a href="/fact-check/?search_term={{ title }}" class="text-white text-xs p-4">View All Fact Checks</a>
                </button>
            </div>
    
            <script>
                const factCheckList = document.getElementById('fact-check-list');
            
                fetch('/fact-check-view/?search_term={{ title }}')
                    .then(response => response.json())
                    .then(data => {
                        const factChecks = data.fact_checks;
            
                        if (factChecks.length === 0) {
                            factCheckList.innerHTML = '<p>No enough fact checks available on this topic.</p>';
                        } else {
                            for (let factCheck of factChecks) {
                                fetch(`/fact-check-proxy?url=${encodeURIComponent(factCheck.claimReview[0].url)}`)
                                    .then(response => response.json())
                                    .then(data => {
                                        const imageUrl = data.image_url || '{% static "images/foogymedia_logo.png" %}';
            
                                        const listItem = `
                                            <li class="fact-check-item rounded-lg shadow-md mb-2 flex flex-col lg:flex-row">
                                                <img src="${imageUrl}" class="w-96 object-cover rounded-lg flex-grow-0 flex-shrink-0 justify-center lg:w-[20%]  lg:mr-4 h-28 rounded-lg" alt="${factCheck.claimReview[0].publisher.site}">
                                                <div class="flex flex-col flex-grow">
                                                    <h3 class="text-sm font-semibold my-2 hover:text-[#FF4560]"><a href="${factCheck.claimReview[0].url}">${factCheck.text}</a></h3>
                                                    <p class="text-gray-300 text-xs mb-2">Claim Date: ${factCheck.claimDate.slice(0, 10)}</p>
                                                    <p class="text-xs lg:text-[10px] mb-2">Claimant: ${factCheck.claimant}</p>
                                                    <p class="text-xs lg:text-sm display-font mb-2"><strong>Rating:</strong> ${factCheck.claimReview[0].textualRating}</p>
                                                </div>
                                            </li>
                                        `;
            
                                        factCheckList.innerHTML += listItem;
                                    })
                                    .catch(error => console.error('Error:', error));
                            }
                        }
                    })
                    .catch(error => console.error('Error:', error));
            </script>
    
    
    

         <script>
            function createModalWithText(triggerElementId, text) {
                var modalId = triggerElementId + 'Modal';
          
                // Create the modal
                var modalHTML = `
                <div id="${modalId}" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center  backdrop-filter backdrop-blur-lg dark:border-slate-50/[0.06] bg-white/100 supports-backdrop-blur:bg-white/60 dark:bg-transparent ">
                    <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50 "></div>
          
                    <div class="modal-container w-11/12 md:max-w-md mx-auto rounded-lg shadow-lg z-50 overflow-y-auto dark:bg-transparent text-white border-slate-400 border-2">
                        <div class="modal-close absolute top-0 right-0 cursor-pointer flex flex-col items-center mt-4 mr-4 text-white text-sm z-50">
                            <svg class="fill-current text-white" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                                <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                            </svg>
                            
                        </div>
          
                        <div class="modal-content py-4 text-left px-6">
                            <div class="flex justify-between items-center pb-3">
                              
                            </div>
                            <p>${text}</p>
                        </div>
                    </div>
                </div>
            `;
          
          
                // Append the modal to the body
                document.body.insertAdjacentHTML('beforeend', modalHTML);
          
                var triggerElement = document.getElementById(triggerElementId);
                var modalElement = document.getElementById(modalId);
                var modalOverlayElement = modalElement.querySelector('.modal-overlay');
          
                // Attach click event to the trigger element
                triggerElement.addEventListener('click', function() {
                    toggleModal(modalElement);
                });
          
                // Attach click event to the modal close elements
                var closeElements = modalElement.getElementsByClassName('modal-close');
                for (var i = 0; i < closeElements.length; i++) {
                    closeElements[i].addEventListener('click', function() {
                        toggleModal(modalElement);
                    });
                }
          
                modalOverlayElement.addEventListener('click', function() {
                    toggleModal(modalElement);
                });
          
          
            }
          
            function toggleModal(modal) {
                modal.classList.toggle('opacity-0')
                modal.classList.toggle('pointer-events-none')
                document.body.classList.toggle('modal-active')
            }
          
            document.onkeydown = function(evt) {
                evt = evt || window.event;
                var isEscape = false;
                if ("key" in evt) {
                    isEscape = (evt.key === "Escape" || evt.key === "Esc");
                } else {
                    isEscape = (evt.keyCode === 27);
                }
                if (isEscape && document.body.classList.contains('modal-active')) {
                    var modals = document.getElementsByClassName('modal');
                    for (var i = 0; i < modals.length; i++) {
                        if (!modals[i].classList.contains('opacity-0')) {
                            toggleModal(modals[i]);
                            break;
                        }
                    }
                }
            };
    
            createModalWithText('topChannels', " Stay informed about the most influential sources and their contributions to the topic's coverage.");
            createModalWithText('popularityOverWeek', 'Track the weekly popularity of a news topic with our informative chart, revealing trends and fluctuations in public interest over time.');
            createModalWithText('topicFactCheck', 'Our comprehensive section provides reliable and verified information, debunking misinformation and ensuring accuracy. Get access to credible sources and enhance your understanding of the topic with our up-to-date fact checks.');
           
        </script>
    </div>
</div></div></div>
</body>
</html>
{% include 'footer.html' %}