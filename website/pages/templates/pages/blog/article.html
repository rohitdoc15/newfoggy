{% load static %} {% comment %} {% include 'header.html'%} {% endcomment %}
<!DOCTYPE html>
<html lang="en">
  {% include 'blogheader.html' %}
  <head>
    <title>{{ blog.title }} | Trending News Blog</title>
    <meta name="description" content="{{ blog.intro_text }}" />
    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700|Source+Sans+Pro:400,700"
      rel="stylesheet"
    />
    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
      integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
      crossorigin="anonymous"
    />
    <!-- Main CSS -->
    <link href="{% static 'blog/assets/css/main.css' %}" rel="stylesheet" />
  </head>
  <body class="pt-[80px]">
    {% comment %}
    <script>
      window.onload = function () {
        var blogPost = document.querySelector(".article-post"); // adjust the selector as needed
        var paragraphs = blogPost.querySelectorAll("p");
        var insertPosition = 2; // Change to adjust the position

        if (paragraphs.length >= insertPosition) {
          var cta = document.createElement("div");
          cta.className = "border p-4 bg-lightblue";
          cta.innerHTML = `
          <div class="row justify-content-between"">
          <div class="col-md-5 mb-md-0" ">
            <h5 class="font-weight-bold secondfont">Check News Bias</h5>
            <p style="font-family:Source Sans Pro; line-height: 1.6; font-size: 1rem; font-weight: 400; ">Check which channel are showing more Modi Godi news</p>
          </div>
          <div class="col-md-7">
            <div class="row">
            <div class="col-md-12 mt-2">
              <a href="https://www.foggymedia.in" target="_blank">
              <button type="submit" class="btn btn-success btn-block">Show me</button>
              </a>
            </div>
            </div>
          </div>
          </div>`;

          // Inserts the CTA after the specified paragraph
          paragraphs[insertPosition - 1].after(cta);
        }
      };
    </script>
    {% endcomment %}
    <!-- HEADER -->

    <div class="container">
      <div
        class="jumbotron jumbotron-fluid mb-3 pl-0 pt-0 pb-0 bg-white position-relative ml-3"
      >
        <div class="">
          <div
            class="row justify-content-between"
            style="display: flex; flex-direction: row"
          >
            <div class="pb-3 lg:pr-6 align-self-center">
              <p class="text-uppercase font-weight-bold"></p>
              <h1
                id="blog-title"
                class="display-4 secondfont mb-3 font-weight-bold"
              >
                {{ blog.title }}
              </h1>
              <p class="mb-3">{{ blog.intro_text }}</p>
              <div class="d-flex align-items-center">
                <img
                  class="rounded-circle"
                  src="{% static 'blog/author.png' %}"
                  style="object-fit: cover"
                  width="70"
                />
                <small class="ml-2"
                  >{{blog.author}}
                  <span class="text-muted d-block"
                    >{{blog.pub_date}} &middot; 2 min. read</span
                  >
                </small>
              </div>
            </div>

            <div
              class="flex sm:h-[400px]"
              style=" width:100%; flex-direction:row; justify-content: center; align-items: center;   background-image:url({{ blog.image.url }}); background-position:center;backdrop-filter: sepia(90%); "
            >
              <img
                id="blog-image"
                src="{{ blog.image.url }}"
                style="max-width: 100%; max-height: 100%"
                class=""
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Header -->
    <script src="https://cdn.tailwindcss.com"></script>
    <div class="" style="position: relative">
      <div
        class="max-w-[600px] lg:w-1/2 h-[290px] mx-auto border-2 border-black relative overflow-hidden"
      >
        <img
          src="https://i.ibb.co/09KpTX0/image-removebg-preview-1-1.png"
          class="mx-auto object-none"
          style="display: flex; justify-content: center"
          alt="T-shirt"
        />
        <!-- Red Overlay -->
        <div
          class=""
          style="
            position: absolute;
            width: 100%;
            bottom: 0;
            background-color: #d9e5de;
            z-index: 10;
            border-top-left-radius: 35px;
            border-top-right-radius: 35px;

            /* Adjust the height to cover 60% of the text */
          "
        >
          <p
            class="font-weight-bold secondfont text-black"
            style="
              font-size: 1.5rem;
              display: flex;
              justify-content: center;
              margin: 0 auto;
              padding-top: 14px;
            "
          >
            {{ blog.extra_context | safe }} Viral Tshirt
          </p>
          <button
            type="button"
            class="rounded-md"
            style="
              display: block;
              margin: 0 auto;
              margin-bottom: 30px;
              background-color: #008260;
              width: 50%;
              padding: 10px;
              color: #fff;
              border: none;
              text-align: center;
            "
            id="affiliateButton"
          >
            Show me
          </button>

          <script>
            function getUserLocation(callback) {
              fetch("https://ipinfo.io/json")
                .then((response) => response.json())
                .then((data) => {
                  const country = data.country;
                  callback(country);
                })
                .catch((error) => {
                  console.error("Error fetching IP info:", error);
                  callback(null);
                });
            }

            function updateAffiliateLink() {
              const affiliateButton =
                document.getElementById("affiliateButton");
              getUserLocation(function (country) {
                let affiliateLink = "";

                if (country) {
                  // Determine the user's location based on their country code
                  if (country === "US") {
                    // User is in the United States
                    affiliateLink =
                      "https://www.amazon.com/gp/search?ie=UTF8&tag=foggymedia01-20&linkCode=ur2&linkId=42e32b8e4b0ae33434decb3c564c73b6&camp=1789&creative=9325&index=apparel&keywords={{ blog.extra_context | safe }} t shirt";
                  } else if (country === "IN") {
                    // User is in India
                    affiliateLink =
                      "https://www.amazon.in/gp/search?ie=UTF8&tag=rohitdoc15-21&linkCode=ur2&linkId=ace6782e362841d0ff0c0516c6d76902&camp=3638&creative=24630&index=apparel&keywords={{ blog.extra_context | safe }} t shirt";
                  }
                }

                // Update the button's data-href attribute with the selected affiliate link
                affiliateButton.setAttribute("data-href", affiliateLink);
              });
            }

            // Call the function to initially set the affiliate link
            updateAffiliateLink();

            // Add click event listener to the button to redirect to the affiliate link when clicked
            document
              .getElementById("affiliateButton")
              .addEventListener("click", () => {
                window.location.href = document
                  .getElementById("affiliateButton")
                  .getAttribute("data-href");
              });
          </script>
        </div>
        <p
          class="w-1/3 md:w-2/5 lg:w-1/3 md:px-4 absolute opacity-90 text-[2vh] md:text-2xl font-mono font-bold text-center text-red-300 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
        >
          {{ blog.extra_context | safe }} is the worst when it comes to dancing
        </p>
      </div>
    </div>

    <!-- MAIN -->
    <div class="container pt-4 pb-4">
      <div class="row justify-content-center">
        <div class="col-lg-2 pr-4 mb-4 col-md-12">
          <div class="sticky-top text-center">
            <div class="text-muted">Share this</div>
            <div class="share d-inline-block">
              <!-- AddToAny BEGIN -->
              <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
                <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
                <a class="a2a_button_facebook"></a>
                <a class="a2a_button_twitter"></a>
              </div>
              <script
                async
                src="https://static.addtoany.com/menu/page.js"
              ></script>
              <!-- AddToAny END -->
            </div>
          </div>
        </div>

        <div class="col-md-12 col-lg-8" id="blog-container" data-page="1">
          <article class="article-post">
            <article class="article-post">
              {{ blog.blog_html_text | safe }}
            </article>
          </article>
          <div class="border p-5 bg-lightblue">
            <div class="row justify-content-between">
              <div class="col-md-5 mb-2 mb-md-0">
                <h5 class="font-weight-bold secondfont">Check News Bias</h5>
                <p>Check which channel are showing more Modi Godi news</p>
              </div>
              <div class="col-md-7">
                <div class="row">
                  <div class="col-md-12 mt-2">
                    <a href="https:foggymedia.in" target="_blank">
                      <button type="submit" class="btn btn-success btn-block">
                        Show me
                      </button>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container pt-4 pb-4">
      <h5 class="font-weight-bold spanborder"><span>Read next</span></h5>
      <div class="row">
        <div class="col-lg-6">
          <div class="card border-0 mb-4 box-shadow h-xl-300">
            <div
              style="height: 150px; background-size: cover; background-repeat: no-repeat; background-image: url('{{ latest_blogs.0.image.url }}');"
            ></div>
            <div
              class="card-body px-0 pb-0 d-flex flex-column align-items-start"
            >
              <h2 class="h4 font-weight-bold">
                <a
                  class="text-dark"
                  href="{% url 'blog-detail' latest_blogs.0.title %}"
                  >{{ latest_blogs.0.title }}</a
                >
              </h2>
              <p class="card-text">{{ latest_blogs.0.summary }}</p>
              <div>
                <small class="d-block">{{ latest_blogs.0.author }}</small>
                <small class="text-muted"
                  >{{ latest_blogs.0.pub_date }} · 2 min read</small
                >
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          {% for latest_blog in latest_blogs|slice:"1:" %}
          <div
            class="mb-3 d-flex align-items-center blog-post ml-3"
            data-bookmark_id="{{ latest_blog.bookmark_id }}"
          >
            <div style="width: 40%; height: auto; padding-right: 1rem">
              <img
                style="width: 100%; height: 80px; object-fit: cover"
                src="{{ latest_blog.image.url }}"
              />
            </div>
            <div class="pl-3" style="width: 70%">
              <h2 class="mb-2 h6 font-weight-bold">
                <a
                  class="text-dark"
                  href="{% url 'blog-detail' latest_blog.title %}"
                  >{{ latest_blog.title }}</a
                >
              </h2>
              <div class="card-text text-muted small">
                {{ latest_blog.author }}
              </div>
              <small class="text-muted"
                >{{ latest_blog.pub_date }} · 5 min read</small
              >
            </div>
          </div>
          {% endfor %}
        </div>
        <div id="blog-list"></div>
      </div>
    </div>
    <!-- End Main -->

    <!-- JAVASCRIPTS -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script type="text/javascript">
      $(window).scroll(function () {
        if (
          $(window).scrollTop() + $(window).height() ==
          $(document).height()
        ) {
          loadMoreBlogs();
        }
      });

      function loadMoreBlogs() {
        var lastBlogId = $(".blog-post:last").data("bookmark_id");

        $.ajax({
          type: "GET",
          url: "/load-more-blogs/",
          data: {
            last_blog_id: lastBlogId,
          },
          success: function (data) {
            // If data is already an object, no need to parse it
            console.log(data);
            var newBlogs = data;
            for (var i in newBlogs) {
              var newBlogHtml =
                "<div class='mb-3 d-flex align-items-center blog-post ml-3' data-bookmark_id='" +
                newBlogs[i].pk +
                "'>" +
                "<div style='width: 40%; height: auto; padding-right:1rem'>" +
                "<img style='width: 100%; height: 150px; object-fit: cover;' src='" +
                newBlogs[i].fields.image +
                "' />" +
                "</div>" +
                "<div class='pl-1' style='width: 50%;'>" +
                "<h2 class='mb-2 h6 font-weight-bold'>" +
                "<a class='text-dark' href='" +
                newBlogs[i].url +
                "'>" +
                newBlogs[i].fields.title +
                "</a>" +
                "</h2>" +
                "<div class='card-text text-muted small'>" +
                newBlogs[i].fields.author +
                "</div>" +
                "<small class='text-muted'>" +
                newBlogs[i].fields.pub_date +
                " · 2 min read</small>" +
                "</div>" +
                "</div>";
              $("#blog-list ").append(newBlogHtml);
            }
          },
          error: function (error) {
            console.log(error);
          },
        });
      }
    </script>

    <script type="text/javascript"></script>
    <script
      src="{% static 'blog/assets/js/vendor/popper.min.js' %}"
      type="text/javascript"
    ></script>
    <script
      src="{% static 'blog/assets/js/vendor/bootstrap.min.js' %}"
      type="text/javascript"
    ></script>
    <script
      src="{% static 'blog/assets/js/functions.js' %}"
      type="text/javascript"
    ></script>
  </body>
</html>
{% include 'blogFooter.html' %}
